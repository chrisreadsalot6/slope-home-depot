window.acsprofiler=function(a){var d,i=1e4,s,l={start:function(e){var t=$.Deferred();if(d===undefined){d=new a({domain:e.domain,sessionId:e.referenceId,environment:e.environment})}try{if(e.methodUrls!==undefined&&e.methodUrls!=="null"){var n=e.methodUrls;if(n!==undefined&&n.length>0&&n[0]!==""){d.debug("valid Method URL Profiling settings detected");s=[];var r=[];u.listenForCompleted(l.matchMessageWithRunningSession);for(var o=0;o<n.length;o++){var i=n[o];r.push(l.runMethodUrl(i))}$.when.apply($,r).then(function(){var e=[];for(var n=0;n<arguments.length;n++){e.push(arguments[n])}t.resolve(e)})}else{d.info("Invalid or incomplete configuration data for MethodURL profiling, skipping.");t.resolve()}}else{d.info("ACS profiling isn't needed, marking as completed.");t.resolve()}}catch(e){d.error("Error while attempting to profile browser for ACS: "+e);t.resolve()}return t.promise()},runMethodUrl:function(e){if(e.MethodURL!==undefined&&e.MethodURL!==""&&e.MethodURL!=="null"){var n=$.Deferred();var t=(new Date).getTime();var r=setTimeout(function(){d.error("MethodURL ["+e.ThreeDSServerTransactionId+"] timeout detected.");l.markMethodUrlAsTimedOut(n,t)},i);var o={deferred:n,threeDSServerTransactionId:e.ThreeDSServerTransactionId,timeoutTimer:r,startTime:t};s.push(o);iframeId=e.ThreeDSServerTransactionId;u.injectIframe(e.MethodURL,e.Payload,iframeId);return n}else{return null}},matchMessageWithRunningSession:function(e){if(e!==undefined&&"CompletionNonce"in e&&e.CompletionNonce!==""&&e.CompletionNonce!=="null"){for(var n=0;n<s.length;n++){var t=s[n];if(t.threeDSServerTransactionId===e.CompletionNonce){var r=l.createResultObject((new Date).getTime()-t.startTime);if("Status"in e&&typeof e.Status==="boolean"){r.Status=e.Status}clearTimeout(t.timeoutTimer);t.deferred.resolve(r);break}}}else{d.warn("invalid data received ["+(typeof e==="object"?JSON.stringify(e,null,4):e)+"]")}},createResultObject:function(e){if(e==undefined||typeof e!=="number"||e<=0){e=-1}return{DataSource:"MethodURL",Status:false,ElapsedTime:e}},markMethodUrlAsTimedOut:function(e,n){if(e!=undefined){var t;if(n==undefined||n<0){t=i}else{t=(new Date).getTime()-n}var r=l.createResultObject(t);e.resolve(r)}else{d.error("Unable to mark MethodURL as timeout, no valid deferred object provided")}},setLogger:function(e){d=e}},u={getCurrentDomain:function(){if(window.location.origin!==undefined){return window.location.origin}else{return window.location.protocol+"//"+window.location.host}},injectIframe:function(e,n,t){var r=document.createElement("iframe"),o=document.createElement("form"),i=document.createElement("input"),a;r.id=t;o.action=e;o.method="POST";d.debug("injecting input info form");o.appendChild(i);i.type="hidden";i.value=n;i.name="threeDSMethodData";d.debug("Injecting iframe");document.body.appendChild(r);a=r.contentDocument||r.contentWindow.document;if(a.body===undefined||a.body===null){a.open();a.write("<body></body>");a.close()}d.debug("Injecting form into iframe");a.body.appendChild(o);d.debug("Submitting Form");o.submit()},messageParser:function(n,e){var t;try{if(n!==undefined&&"data"in n){if(n.origin===u.getCurrentDomain()){t=JSON.parse(n.data);if(t.Type!=null&&t.Type==="DeviceFingerprinter"){switch(t.Message){case"MethodURL.Complete":d.debug("Received a valid MethodURL.Complete message ["+n.data+"]");e.call(this,t);break;case"MethodURL.Error":d.debug("Received a valid MethodURL.Error message ["+n.data+"]");e.call(this,t);break;default:d.error("Unknown message type ["+t.Message+"]");break}}}}}catch(e){d.debug("Post Message event data ("+n.data+") handling failed with "+e)}},listenForCompleted:function(n){if(window.addEventListener){window.addEventListener("message",function(e){u.messageParser(e,n)},false)}else if(el.attachEvent){window.attachEvent("on"+event,function(e){u.messageParser(e,n)})}else{d.error("unable to bind postMessage event to window on user agent: "+window.navigator.userAgent)}}};return l}(window.Logger);