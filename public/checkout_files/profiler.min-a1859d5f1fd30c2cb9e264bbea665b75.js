window.Logger=function(){var e=function(e){try{var r={domain:"merchant",environment:"SBOX",appenders:[]};this.configurations={};if(e===undefined){e={}}$.extend(true,this.configurations,r,e);this.queue=[]}catch(e){}};e.prototype.log=function(e,r){try{var t;if(e!==undefined&&r===undefined){r=e;e="debug"}t={level:e,message:r,time:new Date};this.queue.push(t);if(this.configurations.appenders.indexOf("console")>-1){try{console[e](r)}catch(e){}}}catch(e){}};e.prototype.debug=function(e){try{this.log("debug",e)}catch(e){}};e.prototype.info=function(e){try{this.log("info",e)}catch(e){}};e.prototype.warn=function(e){try{this.log("warn",e)}catch(e){}};e.prototype.error=function(e){try{this.log("error",e)}catch(e){}};return e}();window.profiler=function(s,a){var u,c={BinConfigIdentifiers:null,Cookies:{Legacy:null,LocalStorage:null,SessionStorage:null},DeviceChannel:null,Extended:{Browser:{Adblock:null,AvailableJsFonts:null,DoNotTrack:null,JavaEnabled:navigator.javaEnabled()},Device:{ColorDepth:null,Cpu:null,Platform:null,TouchSupport:{MaxTouchPoints:null,OnTouchStartAvailable:null,TouchEventCreationSuccessful:null}}},Fingerprint:null,FingerprintingTime:null,FingerprintDetails:{Version:null},Language:navigator.language,Latitude:null,Longitude:null,OrgUnitId:null,Origin:null,Plugins:null,ReferenceId:null,Referrer:null,Screen:{FakedResolution:null,Ratio:null,Resolution:null,UsableResolution:null},CallSignEnabled:null,ThreatMetrixEnabled:null,ThreatMetrixEventType:null,ThreatMetrixAlias:null,ThreeDSServerTransId:null,TimeOffset:null,UserAgent:navigator.userAgent,UserAgentDetails:{FakedOS:null,FakedBrowser:null}},d,o=[],e={start:function(n){try{d=new Date;if(u===undefined){u=new a({domain:n.domain,environment:n.environment,sessionId:n.referenceId})}var e=f.startCardinalDataCollection(n),r=f.startThreatMetrix(n),t=f.startMethodUrlProfiling(n),i=f.waitForCallSignCompleted(n);return $.when(e,r,t,i).done(function(e,r,t){if(e!==undefined){o.push(e)}if(r!==undefined){o.push(r)}if(t!==undefined){o=o.concat(t)}u.debug("profiling completed. Final results ["+JSON.stringify(o)+"]");if(n.domain==="ISSUER"){if(n.features!==undefined&&n.features.notificationUrlData!==undefined&&n.features.notificationUrlData.notificationUrl!==undefined){f.redirectToNotificationURL(n.features.notificationUrlData.notificationUrl,n.features.notificationUrlData.base64Payload)}else{u.error("Unable to redirect to merchant NotificationUrl bad feature configuration data")}}else{window.ccaCarrier.profileCompleted("browser",o,n.nonce)}}).then(function(){u.info("Fingerprinting completed.");o=[]})}catch(e){u.error("Error while attempting to profile browser: "+e);o=[]}}},f={collectGeoLocation:function(e){var r=$.Deferred(),t={enableHighAccuracy:true,timeout:5e3,maximumAge:0};if(e){var n=new Date;u.debug("Attempting to collect geolocational data");navigator.geolocation.getCurrentPosition(function(e){u.debug("Successfully received locational data in ["+(new Date).getTime()-n.getTime()+"]ms");c.Latitude=e.coords.latitude;c.Longitude=e.coords.longitude;r.resolve()},function(e){u.error("Failed to collect location using browser API's: ",+e);r.resolve()},t)}else{u.debug("Geolocation is not enabled, skipping.");r.resolve()}return r.promise()},createCardinalDataObject:function(e,r,t){var n,i=new Date,a=i.getTime()-d.getTime();if(e.features.binConfigIdentifiers!==undefined){n=e.features.binConfigIdentifiers}u.debug("Fingerprinter completed, creating data object taking ["+a+"]ms");c.BinConfigIdentifiers=f.filterNullStrings(n);c.BinSessionId=f.filterNullStrings(e.nonce);c.Cookies.Legacy=navigator.cookieEnabled;c.DeviceChannel=f.filterNullStrings(e.deviceChannel);c.Fingerprint=f.filterNullStrings(r);c.FingerprintingTime=a;c.FingerprintDetails.Version=s.VERSION;c.OrgUnitId=f.filterNullStrings(e.orgUnitId);c.Origin=f.filterNullStrings(e.origin);c.ReferenceId=f.filterNullStrings(e.referenceId);c.Referrer=document.referrer;c.ThreatMetrixAlias=f.filterNullStrings(e.features.threatMetrix.alias);c.ThreatMetrixEnabled=e.features.threatMetrix.enabled||false;c.ThreatMetrixEventType=f.filterNullStrings(e.features.threatMetrix.eventType);c.ThreeDSServerTransId=f.filterNullStrings(e.threeDSServerTransId);c.Screen.CCAScreenSize=f.pickScreenSize();if("features"in e&&"callSign"in e.features&&"enabled"in e.features.callSign){c.CallSignEnabled=e.features.callSign.enabled}for(var o=0;o<t.length;o++){var l=t[o];switch(l.key){case"resolution":c.Screen.Resolution=l.value[0]+"x"+l.value[1];c.Screen.Ratio=l.value[0]/l.value[1];break;case"timezone_offset":c.TimeOffset=l.value;break;case"session_storage":c.Cookies.SessionStorage=f.restoreToBoolean(l.value);break;case"local_storage":c.Cookies.LocalStorage=f.restoreToBoolean(l.value);break;case"regular_plugins":c.Plugins=l.value;break;case"cpu_class":c.Extended.Device.Cpu=l.value;break;case"navigator_platform":c.Extended.Device.Platform=l.value;break;case"touch_support":c.Extended.Device.TouchSupport.MaxTouchPoints=l.value[0];c.Extended.Device.TouchSupport.TouchEventCreationSuccessful=l.value[1];c.Extended.Device.TouchSupport.OnTouchStartAvailable=l.value[2];break;case"color_depth":c.Extended.Device.ColorDepth=l.value;break;case"adblock":c.Extended.Browser.Adblock=l.value;break;case"js_fonts":c.Extended.Browser.AvailableJsFonts=l.value;break;case"do_not_track":if(l.value==="1"){c.Extended.Browser.DoNotTrack="enabled"}else if(l.value==="0"){c.Extended.Browser.DoNotTrack="disabled"}else if(l.value===null){c.Extended.Browser.DoNotTrack="not_set"}else{c.Extended.Browser.DoNotTrack=l.value}break;case"available_resolution":c.Screen.UsableResolution=l.value[0]+"x"+l.value[1];break;case"has_lied_resolution":c.Screen.FakedResolution=l.value;break;case"has_lied_os":c.UserAgentDetails.FakedOS=l.value;break;case"has_lied_browser":c.UserAgentDetails.FakedBrowser=l.value;break;default:break}}},filterNullStrings:function(e){return e==="null"?null:e},pickScreenSize:function(){var e=window.outerHeight,r=window.outerWidth,t="02";if(r<390){t="01"}else if(r>=390&&r<500){t="02"}else if(r>=500&&r<600){t="03"}else if(r>=600&&e<600){t="04"}return t},recordLocation:function(e){u.debug("recording location using browser API's");c.Latitude=e.coords.latitude;c.Longitude=e.coords.longitude;f.storeData()},restoreToBoolean:function(e){if(typeof e==="string"){return e==="true"?true:false}else if(typeof e==="number"){return e===1?true:false}else if(typeof e==="boolean"){return e}else{return false}},startCardinalDataCollection:function(t){var n=$.Deferred(),e=navigator.userAgent,r={},i;try{if(t.features.cardinalDataCollection){i=e.match(/firefox/gi);if(i!==null&&i.length>0){r.excludeCanvas=true}u.debug("Starting fingerprinting");if("Fingerprint2"in window){new s(r).get(function(e,r){try{f.createCardinalDataObject(t,e,r);f.collectGeoLocation(f.restoreToBoolean(t.features.geolocationEnabled)).then(function(){return f.storeData(t)}).then(function(){n.resolve()})}catch(e){u.error("Failed while processing the results of Fingerprinting: "+e);n.resolve()}})}else{u.error("Fingerprint2 missing, skipping Cardinal Data");n.resolve()}}else{u.info("Cardinal Data Collection is disabled");n.resolve()}}catch(e){u.error("Failed to start cardinal data collection: "+e);n.resolve()}return n.promise()},startMethodUrlProfiling:function(e){var r=$.Deferred();try{var t=e.features.merchantMethodUrlCollection;if(t!==undefined&&t.methodUrls!==undefined&&t.methodUrls.length>0){t.environment=e.environment;t.referenceId=e.referenceId;t.threeDSServerTransId=e.threeDSServerTransId;u.info("Starting MethodURL Profiling");acsprofiler.start(t).then(function(e){r.resolve(e)})}else{u.info("MethodURL collection is disabled");r.resolve()}}catch(e){u.error("Failed while attempting to start method url profiling: "+e);r.resolve()}return r.promise()},resolveCallSignPromiseWhenExpired:function(e,r){var t=0;try{if("callSignPromiseExpiryTimeMs"in e&&e.callSignPromiseExpiryTimeMs!==""){t=parseInt(e.callSignPromiseExpiryTimeMs,10);if(t>0){setTimeout(function(){if(r.state()!="resolved"){u.error("Did not get callsign WebSdkCompleted Event in Time.  Automatically resolving promise.");r.resolve()}},t)}else{u.error("callSignPromiseExpiryTimeMs not > 0");r.resolve()}}else{u.error("No callSignPromiseExpiryTimeMs");r.resolve()}}catch(e){u.error("Failed to properly parse [profilingConfiguration.features.callSign.callSignPromiseExpiryTimeMs] as a number: "+e);r.resolve()}},dispatchCallSignEvent:function(t,n){var e=0;try{if("callSignTriggerTimeMs"in t&&t.callSignTriggerTimeMs!==""){e=parseInt(t.callSignTriggerTimeMs,10);if(e>0){setTimeout(function(){u.debug("Dispatching callSignTriggerEvent");var e=document.createEvent("Event");e.initEvent("callSignTriggerEvent",true,true);var r=document.getElementById("CallSignTriggerForm");if(r!=null){r.dispatchEvent(e)}f.resolveCallSignPromiseWhenExpired(t,n)},e)}else{u.error("callSignTriggerTimeMs not > 0");n.resolve()}}else{u.error("No callSignTriggerTimeMs");n.resolve()}}catch(e){u.error("Failed to properly parse [profilingConfiguration.features.callSign.callSignTriggerTimeMs] as a number: "+e);n.resolve()}},waitForCallSignCompleted:function(e){var r=$.Deferred();if("features"in e&&"callSign"in e.features&&"enabled"in e.features.callSign&&e.features.callSign.enabled==="true"){try{var t=function(){u.debug("websdkCollectionCompleted Done");r.resolve()};if(window.addEventListener){window.addEventListener("websdkCollectionCompleted",t)}else{window.attachEvent("websdkCollectionCompleted",t)}var n=e.features.callSign;f.dispatchCallSignEvent(n,r)}catch(e){u.error("Failed while attempting to do callsign: "+e);return r.resolve()}return r.promise()}else{u.info("CallSign is disabled");return r.resolve()}return r.resolve()},startThreatMetrix:function(r){try{if(r.features.threatMetrix.enabled){var e=0;try{if("features"in r&&"threatMetrix"in r.features&&"delay"in r.features.threatMetrix&&r.features.threatMetrix.delay!==""){e=r.features.threatMetrix.delay}}catch(e){u.error("Failed to properly parse ["+r.features.threatMetrix.delay+"] as a number: "+e)}return f.waitForThreatMetrix(e)}else{u.info("ThreatMetrix is disabled");return $.Deferred().resolve()}}catch(e){u.error("Failed to start thream metrix: "+e);return $.Deferred().resolve()}},storeData:function(){var r={DataSource:"CardinalData",Status:false,ElapsedTime:-1};u.info("Sending data to save endpoint");return $.ajax({method:"POST",url:"../Browser/SaveBrowserData",data:JSON.stringify(c),contentType:"application/json"}).done(function(){u.info("SaveBrowserData request successfully sent");r.Status=true}).fail(function(e,r,t){u.error("SaveBrowserData request failed: "+r);u.error(t)}).always(function(){var e=(new Date).getTime()-d.getTime();u.info("SaveBrowserDate completed ["+e+"]ms after starting profiling");r.ElapsedTime=e;o.push(r)}).then(null,function(){return $.Deferred().resolve()})},waitForThreatMetrix:function(e){try{var r=$.Deferred(),t={DataSource:"ThreatMetrix",Status:true,ElapsedTime:-1},n;if(e!==undefined&&e>0){n=e-((new Date).getTime()-d);if(n>0){u.debug("Waiting an additional ["+n+"]ms for threatMetrix delay");setTimeout(function(){u.info("ThreatMetrix wait time has completed");t.ElapsedTime=(new Date).getTime()-d;r.resolve(t)},n)}else{var i=(new Date).getTime()-d;u.debug("Current execution time exceeds the threat metrix delay by ["+(i-e)+"]ms, marking threat metrix as completed");t.ElapsedTime=i;r.resolve(t)}}else{r.resolve(t)}}catch(e){u.error("Failed while attempting to wait for Threat Metrix to finish: "+e);r.resolve(t)}return r.promise()},redirectToNotificationURL:function(e,r){var t=document.createElement("form"),n=document.createElement("input");t.action=e;t.method="POST";u.debug("injecting input info form");t.appendChild(n);n.type="hidden";n.value=r;n.name="threeDSMethodData";u.debug("Injecting form into page");document.body.appendChild(t);u.debug("Submitting Form");t.submit()}};return e}(window.Fingerprint2,window.Logger);window.ccaCarrier=function(){var e={sendMessage:function(e){parent.window.postMessage(JSON.stringify(e),"*")},profileCompleted:function(e,r,t){var n={MessageType:"profile.complete",Source:e,Type:"DF",Nonce:t,Results:r};window.ccaCarrier.sendMessage(n)}};return e}();window.isNaN=function(e){var r=Number(e);return r!==r};